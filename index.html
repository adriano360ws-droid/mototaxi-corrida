<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Comprovante de Corrida ‚Äî Moto T√°xi Adriano</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f0f0f">

<style>
:root{
  --bg:#0f0f0f;
  --card:#1a1a1a;
  --muted:#bbb;
  --accent:#19c23b;
  --text:#fff
}
body{
  background:var(--bg);
  color:var(--text);
  font-family:Inter,Arial,Helvetica,sans-serif;
  margin:0;
  padding:18px
}
.wrap{max-width:820px;margin:0 auto}
h1{font-size:20px;margin:0 0 12px}
label{display:block;font-size:14px;color:var(--muted);margin:12px 0 6px}
input,select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  background:#141414;
  color:#fff;
  font-size:16px
}
.btn{
  padding:12px 18px;
  border-radius:12px;
  border:none;
  font-weight:700;
  cursor:pointer
}
.btn-green{background:var(--accent);color:#fff}
.result{
  font-size:56px;
  color:#00ff66;
  text-align:center;
  margin:20px 0;
  font-weight:800
}
.card{
  background:var(--card);
  padding:16px;
  border-radius:14px;
  margin-top:12px;
  color:var(--muted)
}
.small{font-size:13px;white-space:pre-line}
.maps{display:flex;gap:10px;margin-top:14px}
.maps button{
  flex:1;
  background:#333;
  border-radius:10px;
  padding:12px;
  border:none;
  color:#fff
}
.qrwrap{
  margin:14px auto;
  border-radius:14px;
  padding:12px;
  background:#fff;
  width:320px;
  height:320px;
  display:flex;
  align-items:center;
  justify-content:center
}
.qrimg{max-width:100%;max-height:100%}
footer{
  font-size:13px;
  color:var(--muted);
  margin-top:18px;
  text-align:center
}
</style>
</head>

<body>
<div class="wrap">

<h1>Comprovante de Corrida ‚Äî Moto T√°xi Adriano</h1>

<div class="card">
<b>Adriano Alves de Oliveira Souza</b><br>
üìû 86981291332<br>
üèçÔ∏è Honda CG 125 Fan ‚Äî Preta ‚Ä¢ Placa: QRP5G89<br>
PIX: <b>+5586981291332</b>
</div>

<label>Tipo de tarifa</label>
<select id="tarifaTipo">
  <option value="dia">Tarifa Dia ‚Äî R$ 3,00 / km R$ 1,50</option>
  <option value="noite">Tarifa Noite ‚Äî R$ 3,00 / km R$ 1,60</option>
</select>

<label>Destino (obrigat√≥rio)</label>
<input id="destino" placeholder="Ex: Av. Frei Serafim">

<label>Dist√¢ncia (KM)</label>
<input id="km" placeholder="Ex: 2.2">

<button class="btn btn-green" id="btnCalc">Calcular & Gerar</button>

<div id="resultado" class="result">R$ 0,00</div>
<div id="detalhes" class="card small"></div>

<div class="maps">
<button id="btnMaps">üìç Google Maps</button>
<button id="btnWaze">üåç Waze</button>
</div>

<h3 style="text-align:center;margin-top:18px">PIX (valor autom√°tico)</h3>
<div class="qrwrap">
<img id="qrImg" class="qrimg">
</div>

<div class="card small">
<h3>Hist√≥rico de Corridas</h3>
<div id="hist"></div>
<button onclick="limparHistorico()">Limpar hist√≥rico</button>
</div>

<button onclick="compartilhar()" class="btn btn-green">üì≤ Enviar WhatsApp</button>

<footer>Gerado por Moto T√°xi Adriano ‚Äî seguran√ßa para motorista e passageiro</footer>
</div>

<script>
const HIST_KEY = "moto_taxi_hist";

const MOTO_MODELO = "Honda CG 125 Fan";
const MOTO_COR = "Preta";
const MOTO_PLACA = "QRP5G89";

const TARIFAS = {
  dia:{nome:"Tarifa Dia (Bandeira Verde)",base:3.00,km:1.50,min:6.00},
  noite:{nome:"Tarifa Noite (Bandeira Vermelha)",base:3.00,km:1.60,min:7.00}
};

function arred10(v){ return Math.ceil(v*10)/10; }

function gerarPIX(valor){
  const pixKey = "+5586981291332";
  const merchantName = "MOTO TAXI ADRIANO";
  const merchantCity = "TERESINA";
  const amount = valor.toFixed(2);

  const f = (i,v)=> i + v.length.toString().padStart(2,'0') + v;

  function crc16(p){
    let c = 0xFFFF;
    for(let i=0;i<p.length;i++){
      c ^= p.charCodeAt(i)<<8;
      for(let j=0;j<8;j++){
        c = (c & 0x8000) ? (c<<1)^0x1021 : c<<1;
      }
    }
    return (c & 0xFFFF).toString(16).toUpperCase().padStart(4,'0');
  }

  let payload =
    "000201" +
    f("26", f("00","BR.GOV.BCB.PIX") + f("01", pixKey)) +
    "52040000" +
    "5303986" +
    f("54", amount) +
    "5802BR" +
    f("59", merchantName) +
    f("60", merchantCity) +
    f("62", f("05","MTX123")) +
    "6304";

  payload += crc16(payload);

  qrImg.src =
    "https://api.qrserver.com/v1/create-qr-code/?size=600x600&data=" +
    encodeURIComponent(payload);
}

function calcular(){
  if(!destino.value){ alert("Informe o destino"); return; }

  const tipo = tarifaTipo.value;
  const kmVal = parseFloat((km.value||"0").replace(",","."));
  const t = TARIFAS[tipo];

  const dataHora = new Date().toLocaleString("pt-BR",{
    weekday:"long", day:"2-digit", month:"long", year:"numeric",
    hour:"2-digit", minute:"2-digit"
  });

  let total, detalhe;

  if(kmVal>0 && kmVal<=0.9){
    total = t.min;
    detalhe =
`Destino: ${destino.value}
${dataHora}

${t.nome}
Tarifa m√≠nima aplicada
At√© 900 metros
Valor fixo: R$ ${t.min.toFixed(2)}

Moto: ${MOTO_MODELO}
Cor: ${MOTO_COR}
Placa: ${MOTO_PLACA}`;
  } else {
    const bruto = t.base + (kmVal * t.km);
    total = arred10(bruto);
    detalhe =
`Destino: ${destino.value}
${dataHora}

${t.nome}
Bandeira: R$ ${t.base.toFixed(2)}
Dist√¢ncia: ${kmVal.toFixed(2)} km √ó R$ ${t.km.toFixed(2)}
Subtotal: R$ ${bruto.toFixed(2)}
Total final: R$ ${total.toFixed(2)}

Moto: ${MOTO_MODELO}
Cor: ${MOTO_COR}
Placa: ${MOTO_PLACA}`;
  }

  resultado.innerText = "R$ " + total.toFixed(2);
  detalhes.innerText = detalhe;
  gerarPIX(total);
  salvarHistorico(total, detalhe);
}

function salvarHistorico(valor, detalhe){
  const h = JSON.parse(localStorage.getItem(HIST_KEY)||"[]");
  h.unshift({data:new Date().toLocaleString("pt-BR"),valor,detalhe});
  localStorage.setItem(HIST_KEY, JSON.stringify(h));
  renderHist();
}

function renderHist(){
  const h = JSON.parse(localStorage.getItem(HIST_KEY)||"[]");
  hist.innerHTML = h.map(i=>`
<div class="card small">
üßæ COMPROVANTE MOTO T√ÅXI ADRIANO
${i.data}

${i.detalhe}
Total: R$ ${i.valor.toFixed(2)}
</div>`).join("");
}

function limparHistorico(){
  localStorage.removeItem(HIST_KEY);
  renderHist();
}

function compartilhar(){
  const h = JSON.parse(localStorage.getItem(HIST_KEY)||"[]")[0];
  if(!h) return;
  window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(
`üßæ COMPROVANTE MOTO T√ÅXI ADRIANO

${h.detalhe}
Total: R$ ${h.valor.toFixed(2)}
PIX: +5586981291332`
));
}

btnCalc.onclick = calcular;
btnMaps.onclick = ()=>destino.value && window.open("https://www.google.com/maps/dir/?api=1&destination="+encodeURIComponent(destino.value));
btnWaze.onclick = ()=>destino.value && window.open("https://waze.com/ul?q="+encodeURIComponent(destino.value));
renderHist();
</script>

<!-- SERVICE WORKER -->
<script>
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("service-worker.js");
  });
}
</script>

</body>
  </html>
