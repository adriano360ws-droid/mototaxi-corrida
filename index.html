<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Comprovante de Corrida ‚Äî Moto T√°xi Adriano</title>

<meta name="theme-color" content="#0A3D91">
<link rel="manifest" href="manifest.json">
<link rel="icon" sizes="192x192" href="icon-192.png">
<link rel="icon" sizes="512x512" href="icon-512.png">
<link rel="apple-touch-icon" href="icon-192.png">

<style>
:root{
  --bg:#0f0f0f;
  --card:#1a1a1a;
  --accent:#0A3D91;
  --text:#ffffff;
}
body{
  background:var(--bg);
  color:var(--text);
  font-family:Inter,Arial,Helvetica,sans-serif;
  margin:0;
  padding:18px
}
.wrap{max-width:100%;margin:0 auto;}
h1{font-size:20px;margin:0 0 12px;font-weight:800}
label{display:block;font-size:14px;margin:12px 0 6px;font-weight:700}
input,select{
  width:100%;padding:12px;border-radius:10px;border:none;
  background:#141414;color:#fff;font-size:16px
}
.btn{padding:12px 18px;border-radius:12px;border:none;font-weight:700}
.btn-green{background:var(--accent);color:#fff}
.result{font-size:72px;text-align:center;margin:20px 0;font-weight:800}
.card{background:var(--card);padding:16px;border-radius:14px;margin-top:12px}
.maps{display:flex;gap:10px;margin-top:14px}
.maps button{flex:1;background:#243A5E;border:none;border-radius:10px;color:#fff;padding:12px}
.qrwrap{background:#fff;border-radius:14px;padding:12px;margin:14px auto;width:320px;height:320px;display:flex;align-items:center;justify-content:center}
.qrimg{max-width:100%}
footer{text-align:center;margin-top:18px;font-size:13px}
</style>
</head>

<body>
<div class="wrap">

<h1>Comprovante de Corrida ‚Äî Moto T√°xi Adriano</h1>

<div class="card">
<b>Adriano Alves de Oliveira Souza</b><br>
üìû 86981291332<br>
üèçÔ∏è Honda CG 125 Fan ‚Äî Preta ‚Ä¢ Placa QRP5G89<br>
PIX: <b>5586981291332</b>
</div>

<label>Tipo de tarifa</label>
<select id="tarifaTipo">
  <option value="verde">üü¢ Bandeira Verde</option>
  <option value="vermelha">üî¥ Bandeira Vermelha</option>
</select>

<label>Destino</label>
<input id="destino">

<label>Dist√¢ncia (KM)</label>
<input id="km" inputmode="decimal">

<button class="btn btn-green" onclick="calcular()">Calcular & Gerar</button>

<div id="resultado" class="result">R$ 0,00</div>
<div id="detalhes" class="card"></div>

<div class="maps">
  <button onclick="abrirMaps()">üìç Google Maps</button>
  <button onclick="abrirWaze()">üåç Waze</button>
</div>

<h3 style="text-align:center">PIX (valor autom√°tico)</h3>
<div class="qrwrap">
  <img id="qrImg" class="qrimg">
</div>

<!-- üîπ HIST√ìRICO -->
<div class="card">
  <h3>Hist√≥rico de Corridas</h3>
  <div id="hist"></div>
  <button class="btn" onclick="limparHistorico()">üóëÔ∏è Limpar hist√≥rico</button>
</div>

<button class="btn btn-green" onclick="compartilhar()">üì≤ Enviar WhatsApp</button>

<footer>Moto T√°xi Adriano</footer>
</div>

<script>
const HIST_KEY="moto_taxi_hist";

const TARIFAS={
  verde:{base:3,km:1.5,min:6,nome:"Bandeira Verde"},
  vermelha:{base:3,km:1.6,min:7,nome:"Bandeira Vermelha"}
};

function arred10(v){ return Math.ceil(v*10)/10; }

/* PIX ‚Äî N√ÉO MEXIDO */
function crc16(payload){
  let crc=0xFFFF;
  for(let i=0;i<payload.length;i++){
    crc ^= payload.charCodeAt(i)<<8;
    for(let j=0;j<8;j++)
      crc = (crc&0x8000)?(crc<<1)^0x1021:crc<<1;
  }
  return (crc&0xFFFF).toString(16).toUpperCase().padStart(4,"0");
}

function gerarPIX(valor){
  const chave="+5586981291332";
  const txid="***";
  const campo=(i,v)=>i+v.length.toString().padStart(2,"0")+v;

  let p="000201"+
    campo("26",campo("00","BR.GOV.BCB.PIX")+campo("01",chave))+
    "52040000"+"5303986"+
    campo("54",valor.toFixed(2))+
    "5802BR"+
    campo("59","MOTO TAXI ADRIANO")+
    campo("60","TERESINA")+
    campo("62",campo("05",txid))+
    "6304";

  p+=crc16(p);
  qrImg.src="https://api.qrserver.com/v1/create-qr-code/?size=600x600&data="+encodeURIComponent(p);
}

function calcular(){
  const t=TARIFAS[tarifaTipo.value];
  const kmv=parseFloat(km.value.replace(",","."))||0;
  let total, detalhe;

  if(kmv<=0.9){
    total=t.min;
    detalhe=`${t.nome} ‚Äî m√≠nimo at√© 900m`;
  }else{
    total=arred10(t.base+(kmv*t.km));
    detalhe=`${t.nome} ‚Äî ${kmv} km`;
  }

  resultado.innerText="R$ "+total.toFixed(2);
  gerarPIX(total);

  salvarHistorico({
    valor:total.toFixed(2),
    tarifa:t.nome,
    km:kmv,
    destino:destino.value||"N√£o informado",
    data:new Date().toLocaleString("pt-BR")
  });
}

function salvarHistorico(d){
  const h=JSON.parse(localStorage.getItem(HIST_KEY)||"[]");
  h.unshift(d);
  localStorage.setItem(HIST_KEY,JSON.stringify(h));
  renderHist();
}

function renderHist(){
  const h=JSON.parse(localStorage.getItem(HIST_KEY)||"[]");
  hist.innerHTML=h.map(i=>`
  <div style="border-bottom:1px solid #333;margin-bottom:8px">
    <b>R$ ${i.valor}</b> ‚Äî ${i.tarifa}<br>
    üìç ${i.destino}<br>
    üìè ${i.km} km<br>
    üïí ${i.data}
  </div>`).join("");
}

function limparHistorico(){
  localStorage.removeItem(HIST_KEY);
  renderHist();
}

function compartilhar(){}

function abrirMaps(){
  if(destino.value)
    window.open("https://www.google.com/maps/dir/?api=1&destination="+encodeURIComponent(destino.value));
}
function abrirWaze(){
  if(destino.value)
    window.open("https://waze.com/ul?q="+encodeURIComponent(destino.value));
}

renderHist();
</script>

</body>
</html>
