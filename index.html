<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Comprovante de Corrida â€” Moto TÃ¡xi Adriano</title>

<style>
:root{
  --bg:#0f0f0f;
  --card:#1a1a1a;
  --accent:#0A3D91;
  --text:#ffffff;
}
body{
  background:var(--bg);
  color:var(--text);
  font-family:Inter,Arial,Helvetica,sans-serif;
  margin:0;
  padding:18px
}
.wrap{max-width:100%;margin:0 auto;}
h1{font-size:20px;margin:0 0 12px;font-weight:800}
label{display:block;font-size:14px;margin:12px 0 6px;font-weight:700}
input,select{
  width:100%;padding:12px;border-radius:10px;border:none;
  background:#141414;color:#fff;font-size:16px
}
.btn{padding:12px 18px;border-radius:12px;border:none;font-weight:700;cursor:pointer}
.btn-green{background:var(--accent);color:#fff}
.result{font-size:72px;text-align:center;margin:20px 0;font-weight:800}
.card{background:var(--card);padding:16px;border-radius:14px;margin-top:12px}
.maps{display:flex;gap:10px;margin-top:14px}
.maps button{
  flex:1;background:#243A5E;border-radius:10px;padding:12px;border:none;color:#fff
}
.qrwrap{
  margin:14px auto;border-radius:14px;padding:12px;background:#fff;
  width:320px;height:320px;display:flex;align-items:center;justify-content:center
}
.qrimg{max-width:100%;max-height:100%}
footer{text-align:center;margin-top:18px;font-size:13px}
</style>
</head>

<body>
<div class="wrap">

<h1>Comprovante de Corrida â€” Moto TÃ¡xi Adriano</h1>

<div class="card">
<b>Adriano Alves de Oliveira Souza</b><br>
ğŸ“ 86981291332<br>
ğŸï¸ Honda CG 125 Fan â€” Preta â€¢ Placa: QRP5G89<br>
PIX: <b>5586981291332</b>
</div>

<label>Tipo de tarifa</label>
<select id="tarifaTipo">
  <option value="verde">ğŸŸ¢ Bandeira Verde â€” Base R$ 3,00 | Km R$ 1,50</option>
  <option value="vermelha">ğŸ”´ Bandeira Vermelha â€” Base R$ 3,00 | Km R$ 1,60</option>
</select>

<label>Destino</label>
<input id="destino">

<label>DistÃ¢ncia (KM)</label>
<input id="km">

<button class="btn btn-green" onclick="calcular()">Calcular & Gerar</button>

<div id="resultado" class="result">R$ 0,00</div>
<div id="detalhes" class="card"></div>

<div class="maps">
  <button onclick="abrirMaps()">ğŸ“ Google Maps</button>
  <button onclick="abrirWaze()">ğŸŒ Waze</button>
</div>

<h3 style="text-align:center">PIX (valor automÃ¡tico)</h3>
<div class="qrwrap">
  <img id="qrImg" class="qrimg">
</div>

<div class="card">
<h3>HistÃ³rico de Corridas</h3>
<div id="hist"></div>
<button class="btn" onclick="limparHistorico()">ğŸ—‘ï¸ Limpar histÃ³rico</button>
</div>

<button onclick="compartilhar()" class="btn btn-green">ğŸ“² Enviar WhatsApp</button>

<footer>Moto TÃ¡xi Adriano</footer>
</div>

<script>
const HIST_KEY="moto_taxi_hist";

const TARIFAS={
  verde:{base:3,km:1.5,min:6,nome:"Bandeira Verde"},
  vermelha:{base:3,km:1.6,min:7,nome:"Bandeira Vermelha"}
};

function arred10(v){ return Math.ceil(v*10)/10; }

/* CRC16 PIX */
function crc16(payload){
  let crc=0xFFFF;
  for(let i=0;i<payload.length;i++){
    crc ^= payload.charCodeAt(i) << 8;
    for(let j=0;j<8;j++){
      crc = (crc & 0x8000) ? (crc << 1) ^ 0x1021 : crc << 1;
    }
  }
  return (crc & 0xFFFF).toString(16).toUpperCase().padStart(4,"0");
}

/* PIX OFICIAL â€” COM TXID (CAMPO 62) */
function gerarPIX(valor){
  const chave = "+5586981291332";
  const txid  = "***";

  function campo(id,v){
    return id + v.length.toString().padStart(2,"0") + v;
  }

  let payload =
    "000201" +
    campo("26",
      campo("00","BR.GOV.BCB.PIX") +
      campo("01",chave) +
      campo("02","Corrida Moto Taxi")
    ) +
    "52040000" +
    "5303986" +
    campo("54", valor.toFixed(2)) +
    "5802BR" +
    campo("59","MOTO TAXI ADRIANO") +
    campo("60","TERESINA") +
    campo("62", campo("05", txid)) +
    "6304";

  payload += crc16(payload);

  document.getElementById("qrImg").src =
    "https://api.qrserver.com/v1/create-qr-code/?size=600x600&data=" +
    encodeURIComponent(payload);
}

/* CALCULAR */
function calcular(){
  const t=TARIFAS[tarifaTipo.value];
  const kmv=parseFloat(km.value.replace(",","."))||0;

  let total, regra, detalhe;

  if(kmv<=0.9){
    total=t.min;
    regra="minimo";
    detalhe=`ğŸš¦ <b>${t.nome}</b><br>
â€¢ Corridas atÃ© 900 metros<br>
ğŸ‘‰ <b>Valor mÃ­nimo fixo: R$ ${t.min.toFixed(2)}</b>`;
  }else{
    total=arred10(t.base+(kmv*t.km));
    regra="normal";
    detalhe=`ğŸš¦ <b>${t.nome}</b><br>
â€¢ Tarifa base: R$ ${t.base.toFixed(2)}<br>
â€¢ Valor por km: R$ ${t.km.toFixed(2)}<br>
ğŸ‘‰ CÃ¡lculo: R$ ${t.base.toFixed(2)} + (${kmv} Ã— ${t.km.toFixed(2)})`;
  }

  resultado.innerText="R$ "+total.toFixed(2);
  detalhes.innerHTML=detalhe;
  gerarPIX(total);

  salvarHistorico({
    valor:total.toFixed(2),
    tarifa:t.nome,
    km:kmv,
    destino:destino.value||"NÃ£o informado",
    regra,
    data:new Date().toLocaleString("pt-BR")
  });
}

/* HISTÃ“RICO */
function salvarHistorico(d){
  const h=JSON.parse(localStorage.getItem(HIST_KEY)||"[]");
  h.unshift(d);
  localStorage.setItem(HIST_KEY,JSON.stringify(h));
  renderHist();
}
function renderHist(){
  const h=JSON.parse(localStorage.getItem(HIST_KEY)||"[]");
  hist.innerHTML=h.map(i=>`
  <div style="border-bottom:1px solid #333;margin-bottom:8px">
    <b>R$ ${i.valor}</b> â€” ${i.tarifa}<br>
    ğŸ“ ${i.destino}<br>
    ğŸ“ ${i.km} km<br>
    ğŸ•’ ${i.data}
  </div>`).join("");
}
function limparHistorico(){
  localStorage.removeItem(HIST_KEY);
  renderHist();
}

/* MAPAS */
function abrirMaps(){
  if(destino.value)
    window.open("https://www.google.com/maps/dir/?api=1&destination="+encodeURIComponent(destino.value));
}
function abrirWaze(){
  if(destino.value)
    window.open("https://waze.com/ul?q="+encodeURIComponent(destino.value));
}

/* WHATSAPP â€” COMPROVANTE COMPLETO */
function compartilhar(){
  const h = JSON.parse(localStorage.getItem(HIST_KEY) || "[]")[0];
  if(!h) return;

  const t = Object.values(TARIFAS).find(x => x.nome === h.tarifa);

  const agora = new Date();
  const data = agora.toLocaleDateString("pt-BR",{
    weekday:"long",
    day:"2-digit",
    month:"long",
    year:"numeric"
  });
  const hora = agora.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});

  let detalhesCalculo = "";

  if(h.tarifa === "Bandeira Verde"){
    detalhesCalculo = `
ğŸš¦ *Bandeira Verde*
â€¢ Tarifa base: R$ 3,00
â€¢ Valor por km: R$ 1,50
${h.regra === "minimo"
? "â€¢ Corridas atÃ© 900 metros:\nğŸ‘‰ *Valor mÃ­nimo fixo: R$ 6,00*"
: `ğŸ‘‰ CÃ¡lculo: R$ 3,00 + (${h.km} km Ã— R$ 1,50)`}`;
  }

  if(h.tarifa === "Bandeira Vermelha"){
    detalhesCalculo = `
ğŸš¦ *Bandeira Vermelha*
â€¢ Tarifa base: R$ 3,00
â€¢ Valor por km: R$ 1,60
${h.regra === "minimo"
? "â€¢ Corridas atÃ© 900 metros:\nğŸ‘‰ *Valor mÃ­nimo fixo: R$ 7,00*"
: `ğŸ‘‰ CÃ¡lculo: R$ 3,00 + (${h.km} km Ã— R$ 1,60)`}`;
  }

  const texto =
`ğŸ§¾ *COMPROVANTE DE CORRIDA â€“ MOTO TÃXI ADRIANO*

ğŸ“… ${data} Ã s ${hora}

ğŸ‘¤ *Moto TÃ¡xi:* Adriano
ğŸï¸ *Moto:* Honda CG 125 Fan
ğŸ¨ *Cor:* Preta
ğŸ”¢ *Placa:* QRP5G89

ğŸ“ *Destino:* ${h.destino}

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’° *CÃLCULO DA CORRIDA*

${detalhesCalculo}

ğŸ“Œ *Acima de 900 metros o valor Ã© calculado normalmente pela distÃ¢ncia percorrida.*

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ’µ *VALOR FINAL DA CORRIDA*
ğŸ‘‰ R$ ${h.valor}

âœ… *PIX recebido*
Pagamento autorizado.
Corrida paga com sucesso.

ğŸ™ Obrigado pela preferÃªncia.
*Moto TÃ¡xi Adriano agradece!*`;

  window.open(
    "https://api.whatsapp.com/send?text=" +
    encodeURIComponent(texto)
  );
}

renderHist();
</script>

</body>
</html>
