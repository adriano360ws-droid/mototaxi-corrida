<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Comprovante de Corrida ‚Äî Moto T√°xi Adriano</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f0f0f">
<style>
:root{
  --bg:#0f0f0f;
  --card:#1a1a1a;
  --muted:#bfc7d5;
  --accent:#0A3D91; /* AZUL PROFISSIONAL */
  --text:#ffffff;
}
body{
  background:var(--bg);
  color:var(--text);
  font-family:Inter,Arial,Helvetica,sans-serif;
  margin:0;
  padding:18px
}
.wrap{max-width:820px;margin:0 auto}
h1{font-size:20px;margin:0 0 12px}
label{display:block;font-size:14px;color:var(--muted);margin:12px 0 6px}
input,select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  background:#141414;
  color:#fff;
  font-size:16px
}
.btn{
  padding:12px 18px;
  border-radius:12px;
  border:none;
  font-weight:700;
  cursor:pointer
}.btn-green{
  background:var(--accent);
  color:#ffffff;
  box-shadow:0 6px 14px rgba(10,61,145,0.45);
}

  .result{
  font-size:56px;
  color:var(--accent);
  text-align:center;
  margin:20px 0;
  font-weight:800;
}
.card{
  background:var(--card);
  padding:16px;
  border-radius:14px;
  margin-top:12px;
  color:var(--muted)
}
.small{font-size:13px}
.maps{display:flex;gap:10px;margin-top:14px}
.maps button{
  flex:1;
  background:#243A5E; /* azul escuro elegante */
  border-radius:10px;
  padding:12px;
  border:none;
  color:#ffffff;
  font-weight:600;
}
.qrwrap{
  margin:14px auto;
  border-radius:14px;
  padding:12px;
  background:#fff;
  width:320px;
  height:320px;
  display:flex;
  align-items:center;
  justify-content:center
}
.qrimg{max-width:100%;max-height:100%}
footer{
  font-size:13px;
  color:var(--muted);
  margin-top:18px;
  text-align:center
}
</style>
</head>

<body>
<div class="wrap">

<h1>Comprovante de Corrida ‚Äî Moto T√°xi Adriano</h1>

<div class="card">
<b>Adriano Alves de Oliveira Souza</b><br>
üìû 86981291332<br>
üèçÔ∏è Honda CG 125 Fan ‚Äî Preta ‚Ä¢ Placa: QRP5G89<br>
PIX: <b>+5586981291332</b>
</div>

<label>Tipo de tarifa</label>
<select id="tarifaTipo">
  <option value="verde">üü¢ Bandeira Verde ‚Äî Base R$ 3,00 | Km R$ 1,50</option>
  <option value="vermelha">üî¥ Bandeira Vermelha ‚Äî Base R$ 3,00 | Km R$ 1,60</option>
</select>

<label>Destino (obrigat√≥rio)</label>
<input id="destino">

<label>Dist√¢ncia (KM)</label>
<input id="km">

<button class="btn btn-green" id="btnCalc">Calcular & Gerar</button>

<div id="resultado" class="result">R$ 0,00</div>
<div id="detalhes" class="card small"></div>

<div class="maps">
<button id="btnMaps">üìç Google Maps</button>
<button id="btnWaze">üåç Waze</button>
</div>

<h3 style="text-align:center;margin-top:18px">PIX (valor autom√°tico)</h3>
<div class="qrwrap">
<img id="qrImg" class="qrimg">
</div>

<div class="card small">
<h3>Hist√≥rico de Corridas</h3>
<div id="hist"></div>
<button onclick="limparHistorico()">Limpar hist√≥rico</button>
</div>

<button onclick="compartilhar()" class="btn btn-green">üì≤ Enviar WhatsApp</button>

<footer>Gerado por Moto T√°xi ‚Äî envie ao passageiro s√≥ por mensagem (seguran√ßa)</footer>
</div>

<script>
/* ===== CONFIGURA√á√ïES ===== */
const PIX_KEY_RAW = "86981291332";
const RECEIVER_NAME = "MOTO TAXI ADRIANO";
const CITY = "TERESINA";
const HIST_KEY = "moto_taxi_hist";

/* ===== TARIFAS ===== */
const TARIFAS = {
  verde:{
    nome:"Bandeira Verde",
    base:3.00,
    km:1.50,
    min:6.00
  },
  vermelha:{
  nome:"Bandeira Vermelha",
  base:3.00,
  km:1.60,
  min:7.00
}
};

/* ===== UTIL ===== */
function arred10(v){ return Math.ceil(v*10)/10; }

function chavePixNormalizada(){
  return PIX_KEY_RAW.startsWith("55")
    ? "+" + PIX_KEY_RAW
    : "+55" + PIX_KEY_RAW;
}

/* ===== CRC16 PIX ===== */
function crc16(payload){
  let crc=0xFFFF;
  for(let i=0;i<payload.length;i++){
    crc^=payload.charCodeAt(i)<<8;
    for(let j=0;j<8;j++){
      crc=(crc&0x8000)?(crc<<1)^0x1021:crc<<1;
    }
  }
  return (crc&0xFFFF).toString(16).toUpperCase().padStart(4,"0");
}

/* ===== PIX ===== */
function gerarPIX(valor){
  const v=valor.toFixed(2);
  const nome=RECEIVER_NAME.substring(0,25);
  const cidade=CITY.substring(0,15);
  const chave=chavePixNormalizada();
  const campo=(id,val)=>id+val.length.toString().padStart(2,"0")+val;

  let payload="000201"+
    campo("26",campo("00","BR.GOV.BCB.PIX")+campo("01",chave))+
    "52040000"+
    "5303986"+
    campo("54",v)+
    "5802BR"+
    campo("59",nome)+
    campo("60",cidade)+
    campo("62",campo("05","***"))+
    "6304";

  payload+=crc16(payload);
  qrImg.src="https://api.qrserver.com/v1/create-qr-code/?size=600x600&data="+encodeURIComponent(payload);
}

/* ===== C√ÅLCULO ===== */
function calcular(){
  const tipo=tarifaTipo.value;
  const km=parseFloat((document.getElementById("km").value||"0").replace(",","."));
  const destinoTxt=document.getElementById("destino").value||"N√£o informado";
  const t=TARIFAS[tipo];
  let total, detalhe;

  if(km>0 && km<=0.9){
    total=t.min;
    detalhe=`Tarifa m√≠nima aplicada<br>
    At√© 900 metros<br>
    ${t.nome}<br>
    Valor fixo: R$ ${t.min.toFixed(2)}`;
  }else{
    const bruto=t.base+(km*t.km);
    total=arred10(bruto);
    detalhe=`${t.nome}<br>
    Base: R$ ${t.base.toFixed(2)}<br>
    Dist√¢ncia: ${km.toFixed(2)} km √ó R$ ${t.km.toFixed(2)}<br>
    Subtotal: R$ ${bruto.toFixed(2)}<br>
    Total final: R$ ${total.toFixed(2)}`;
  }

  resultado.innerText="R$ "+total.toFixed(2);
  detalhes.innerHTML=detalhe;
  gerarPIX(total);
  salvarHistorico(total,destinoTxt,detalhe);
}

/* ===== HIST√ìRICO ===== */
function salvarHistorico(valor,destino,detalhe){
  const d=new Date();
  const registro={
    data:d.toLocaleDateString("pt-BR")+" "+d.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),
    destino,valor,detalhe
  };
  const h=JSON.parse(localStorage.getItem(HIST_KEY)||"[]");
  h.unshift(registro);
  localStorage.setItem(HIST_KEY,JSON.stringify(h));
  renderHist();
}

function renderHist(){
  const h=JSON.parse(localStorage.getItem(HIST_KEY)||"[]");
  hist.innerHTML=h.length
    ? h.map(i=>`<div class="card small">${i.data}<br>${i.destino}<br><b>R$ ${i.valor.toFixed(2)}</b></div>`).join("")
    : "<i>Nenhuma corrida registrada</i>";
}

function limparHistorico(){
  localStorage.removeItem(HIST_KEY);
  renderHist();
}

/* ===== WHATSAPP ===== */
function compartilhar(){
  const h=JSON.parse(localStorage.getItem(HIST_KEY)||"[]")[0];
  if(!h) return;
  const agora = new Date();
const dataHora = agora.toLocaleString("pt-BR", {
  weekday: "long",
  day: "2-digit",
  month: "long",
  year: "numeric",
  hour: "2-digit",
  minute: "2-digit"
});

// informa√ß√µes salvas no hist√≥rico
const valor = h.valor.toFixed(2);

// regras fixas do seu sistema
const limiteMinimo = 0.9; // 900 metros
const bandeiraVerdeMin = 6.00;
const bandeiraVermelhaMin = 7.00;

// texto explicativo padr√£o (n√£o quebra)
const texto = `
üßæ *COMPROVANTE DE CORRIDA ‚Äì MOTO T√ÅXI ADRIANO*

üìÖ ${dataHora}

üë§ *Moto T√°xi:* Adriano  
üèçÔ∏è *Moto:* Honda CG 125 Fan  
üé® *Cor:* Preta  
üî¢ *Placa:* QRP5G89  

üìç *Destino:* ${h.destino}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üí∞ *C√ÅLCULO DA CORRIDA*

üö¶ *Bandeira Verde*
‚Ä¢ Tarifa base: R$ 3,00  
‚Ä¢ Valor por km: R$ 1,50  
‚Ä¢ Corridas at√© 900 metros:  
üëâ *Valor m√≠nimo fixo: R$ 6,00*

üö¶ *Bandeira Vermelha*
‚Ä¢ Tarifa base: R$ 3,00  
‚Ä¢ Valor por km: R$ 1,60  
‚Ä¢ Corridas at√© 900 metros:  
üëâ *Valor m√≠nimo fixo: R$ 7,00*

üìå *Acima de 900 metros o valor √© calculado normalmente pela dist√¢ncia percorrida.*

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üíµ *VALOR FINAL DA CORRIDA*
üëâ R$ ${valor}

‚úÖ *PIX recebido*
Pagamento autorizado.
Corrida paga com sucesso.

üôè Obrigado pela prefer√™ncia.
*Moto T√°xi Adriano agradece!*
`;
  window.open("https://api.whatsapp.com/send?text="+encodeURIComponent(texto));
}

/* ===== EVENTOS ===== */
document.getElementById("btnCalc").onclick=calcular;
document.getElementById("btnMaps").onclick=()=>destino.value&&window.open("https://www.google.com/maps/dir/?api=1&destination="+encodeURIComponent(destino.value));
document.getElementById("btnWaze").onclick=()=>destino.value&&window.open("https://waze.com/ul?q="+encodeURIComponent(destino.value));
renderHist();
</script>
</body>
</html>




